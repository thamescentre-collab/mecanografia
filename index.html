<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thames Centre Typing Master</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root {
--primary: #4f46e5;
--primary-light: #818cf8;
--secondary: #10b981;
--danger: #ef4444;
--dark: #1e293b;
--light: #f8fafc;
--gray: #94a3b8;
--gray-light: #e2e8f0;
--shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
--transition: all 0.3s ease;
/* Colores para dedos */
--left-pinky-color: #f87171; /* Rojo claro */
--left-ring-color: #fb923c; /* Naranja */
--left-middle-color: #facc15; /* Amarillo */
--left-index-color: #4ade80; /* Verde */
--right-index-color: #60a5fa; /* Azul */
--right-middle-color: #c084fc; /* Morado */
--right-ring-color: #f472b6; /* Rosa */
--right-pinky-color: #94a3b8; /* Gris */
--thumb-color: #64748b; /* Gris oscuro */
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Poppins', sans-serif;
}
body {
background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
min-height: 100vh;
display: flex;
flex-direction: column;
align-items: center;
padding: 20px;
color: var(--dark);
overflow-x: hidden; /* Prevenir scroll horizontal */
}
.app-container {
width: 100%;
max-width: 1200px;
background-color: white;
border-radius: 16px;
box-shadow: var(--shadow);
overflow: hidden;
margin-bottom: 30px;
}
.app-header {
background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
color: white;
padding: 25px 40px;
text-align: center;
}
.app-header h1 {
font-size: 2.5rem;
font-weight: 700;
margin-bottom: 10px;
text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.app-header p {
font-size: 1.1rem;
opacity: 0.9;
}
.main-content {
padding: 30px;
}
/* Pantalla de login */
.login-container {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 40px;
max-width: 500px;
margin: 0 auto;
}
.login-form {
background-color: white;
border-radius: 16px;
box-shadow: var(--shadow);
padding: 40px;
width: 100%;
}
.login-title {
font-size: 2rem;
font-weight: 700;
margin-bottom: 30px;
text-align: center;
color: var(--primary);
}
.login-subtitle {
font-size: 1rem;
font-weight: 500;
margin-bottom: 20px;
text-align: center;
color: var(--gray);
}
.form-group {
margin-bottom: 20px;
}
.form-group label {
display: block;
margin-bottom: 8px;
font-weight: 500;
color: var(--dark);
}
.form-group input, .form-group select, .form-group textarea {
width: 100%;
padding: 12px 15px;
border: 1px solid var(--gray-light);
border-radius: 8px;
font-size: 1rem;
transition: var(--transition);
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}
.form-group textarea {
min-height: 120px;
resize: vertical;
}
.btn {
background-color: var(--primary);
color: white;
border: none;
border-radius: 8px;
padding: 12px 25px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: var(--transition);
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
width: 100%;
}
.btn:hover {
background-color: #4338ca;
transform: translateY(-2px);
}
.btn-secondary {
background-color: var(--gray);
}
.btn-secondary:hover {
background-color: #64748b;
}
.btn-danger {
background-color: var(--danger);
}
.btn-danger:hover {
background-color: #dc2626;
}
.login-options {
display: flex;
justify-content: space-between;
margin-top: 30px;
}
.login-options button {
flex: 1;
margin: 0 5px;
}
.user-type {
display: flex;
justify-content: center;
margin-bottom: 20px;
gap: 20px;
}
.user-type button {
flex: 1;
padding: 10px;
border: 2px solid var(--gray-light);
background-color: white;
border-radius: 8px;
cursor: pointer;
transition: var(--transition);
}
.user-type button.active {
border-color: var(--primary);
background-color: rgba(79, 70, 229, 0.1);
color: var(--primary);
}
.admin-panel {
display: none;
position: relative;
}
.admin-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 30px;
padding-bottom: 15px;
border-bottom: 1px solid var(--gray-light);
}
.admin-title {
font-size: 1.8rem;
font-weight: 600;
color: var(--primary);
}
.lessons-container {
margin-bottom: 30px;
}
.lessons-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.lessons-title {
font-size: 1.5rem;
font-weight: 600;
color: var(--dark);
}
.lesson-card {
background-color: white;
border-radius: 12px;
padding: 20px;
margin-bottom: 15px;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
border-left: 5px solid var(--primary);
transition: var(--transition);
cursor: move;
position: relative;
}
.lesson-card:hover {
transform: translateY(-3px);
box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
}
.lesson-card.dragging {
opacity: 0.5;
cursor: move;
}
.lesson-card.drag-over {
border-top: 3px dashed var(--primary);
background-color: rgba(79, 70, 229, 0.05);
}
.lesson-card-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
}
.lesson-card-title {
font-size: 1.2rem;
font-weight: 600;
color: var(--primary);
}
.lesson-level {
display: flex;
align-items: center;
gap: 5px;
color: var(--gray);
}
.stars {
color: #fbbf24;
}
.lesson-content {
margin-bottom: 15px;
color: var(--gray);
line-height: 1.6;
max-height: 100px;
overflow-y: auto;
}
.lesson-actions {
display: flex;
gap: 10px;
}
.lesson-actions button {
padding: 8px 15px;
font-size: 0.9rem;
}
.lesson-form {
background-color: var(--light);
border-radius: 12px;
padding: 25px;
margin-bottom: 30px;
display: none;
}
.lesson-form.active {
display: block;
}
.form-actions {
display: flex;
gap: 15px;
margin-top: 20px;
}
.student-panel {
display: none;
}
.lesson-info {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
padding: 15px 20px;
background-color: var(--light);
border-radius: 12px;
border-left: 5px solid var(--primary);
}
.lesson-selector {
display: flex;
align-items: center;
gap: 15px;
}
.lesson-selector select {
padding: 8px 15px;
border: 1px solid var(--gray-light);
border-radius: 8px;
font-size: 1rem;
background-color: white;
cursor: pointer;
}
.lesson-title {
font-size: 1.5rem;
font-weight: 600;
color: var(--primary);
}
.lesson-level {
display: flex;
align-items: center;
gap: 8px;
color: var(--gray);
}
.progress-bar {
height: 8px;
background-color: var(--gray-light);
border-radius: 4px;
margin-bottom: 20px;
overflow: hidden;
}
.progress {
height: 100%;
background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
border-radius: 4px;
width: 0%;
transition: width 0.5s ease;
}
.typing-area {
background-color: var(--light);
border-radius: 12px;
padding: 20px;
margin-bottom: 20px;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
overflow: hidden; /* Prevenir scroll */
}
.text-display {
font-size: 1.8rem;
line-height: 1.8;
margin-bottom: 15px;
padding: 20px;
border-radius: 10px;
background-color: white;
box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
border: 1px solid var(--gray-light);
min-height: 200px;
max-height: 400px;
letter-spacing: 0.5px;
overflow-y: auto; /* Permitir desplazamiento vertical */
white-space: pre-wrap; /* Respetar saltos de línea */
word-wrap: break-word; /* Romper palabras largas */
position: relative; /* Para posicionamiento del cursor */
}
.char {
position: relative;
transition: var(--transition);
padding: 2px 0;
display: inline-block; /* Asegurar que se comporte como bloque en línea */
}
.char.current {
background-color: var(--primary);
color: white;
border-radius: 4px;
animation: pulse 1s infinite;
}
.char.correct {
background-color: var(--secondary);
color: white;
border-radius: 4px;
}
.char.incorrect {
background-color: var(--danger);
color: white;
border-radius: 4px;
position: relative;
}
.char.incorrect::after {
content: '✗';
position: absolute;
top: -8px;
right: -8px;
background-color: var(--danger);
color: white;
border-radius: 50%;
width: 18px;
height: 18px;
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
font-weight: bold;
z-index: 10; /* Asegurar que esté por encima */
transform: translate(0, 0); /* Evitar que afecte el flujo del documento */
}
@keyframes pulse {
0% { opacity: 1; }
50% { opacity: 0.7; }
100% { opacity: 1; }
}
.keyboard-container {
background-color: var(--dark);
border-radius: 12px;
padding: 12px;
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
margin-bottom: 20px;
position: relative;
}
.keyboard-row {
display: flex;
justify-content: center;
margin-bottom: 6px;
}
.key {
background-color: #334155;
color: white;
border: none;
border-radius: 6px;
padding: 10px;
margin: 0 2px;
font-size: 0.85rem;
font-weight: 500;
min-width: 35px;
cursor: pointer;
transition: var(--transition);
box-shadow: 0 3px 0 #1e293b;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
position: relative;
}
.key:hover {
filter: brightness(1.1);
}
.key.space {
min-width: 200px;
}
.key.active {
transform: translateY(3px);
box-shadow: 0 0 0 #1e293b;
filter: brightness(1.3);
}
.key.correct {
transform: translateY(3px);
box-shadow: 0 0 0 #1e293b;
filter: brightness(1.3);
}
.key.incorrect {
transform: translateY(3px);
box-shadow: 0 0 0 #1e293b;
filter: brightness(0.7);
}

/* Colores para teclas según dedo */
.key.left-pinky {
background-color: var(--left-pinky-color);
}
.key.left-ring {
background-color: var(--left-ring-color);
}
.key.left-middle {
background-color: var(--left-middle-color);
}
.key.left-index {
background-color: var(--left-index-color);
}
.key.right-index {
background-color: var(--right-index-color);
}
.key.right-middle {
background-color: var(--right-middle-color);
}
.key.right-ring {
background-color: var(--right-ring-color);
}
.key.right-pinky {
background-color: var(--right-pinky-color);
}
.key.thumb {
background-color: var(--thumb-color);
}

/* Estilos para caracteres secundarios en teclas */
.key-char-main {
font-size: 0.9rem;
font-weight: 600;
color: white;
}
.key-char-top {
position: absolute;
top: 2px;
left: 4px;
font-size: 0.7rem;
opacity: 0.8;
color: white;
}
.key-char-top-right {
position: absolute;
top: 2px;
right: 4px;
font-size: 0.7rem;
opacity: 0.8;
color: white;
}
.key-char-bottom {
position: absolute;
bottom: 2px;
left: 4px;
font-size: 0.6rem;
opacity: 0.8;
color: white;
}
.key-char-bottom-right {
position: absolute;
bottom: 2px;
right: 4px;
font-size: 0.6rem;
opacity: 0.8;
color: white;
}

/* Símbolos más grandes para la fila numérica y acentos */
.key-large-symbols .key-char-top {
font-size: 0.8rem;
font-weight: 600;
}
.key-large-symbols .key-char-top-right {
font-size: 0.8rem;
font-weight: 600;
}

/* Teclas especiales */
.key-wide {
min-width: 60px;
}
.key-xwide {
min-width: 90px;
}
.key-xxwide {
min-width: 120px;
}
.key-enter {
min-width: 80px;
height: 84px;
}
.key-shift {
min-width: 100px;
}
.key-space {
min-width: 250px;
}

/* Estilo para la tecla esperada */
.key.expected {
box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
transform: scale(1.1);
z-index: 10;
border: 2px solid white;
animation: glow 1.5s infinite alternate;
}

@keyframes glow {
from {
box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
}
to {
box-shadow: 0 0 20px rgba(255, 255, 255, 1), 0 0 30px rgba(255, 255, 255, 0.8);
}
}

.stats-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin-bottom: 20px;
}
.stat-card {
background-color: white;
border-radius: 12px;
padding: 20px;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
text-align: center;
transition: var(--transition);
border-top: 4px solid var(--primary);
}
.stat-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}
.stat-card.accuracy {
border-top-color: var(--secondary);
}
.stat-card.time {
border-top-color: #f59e0b;
}
.stat-card.errors {
border-top-color: var(--danger);
}
.stat-icon {
font-size: 2rem;
margin-bottom: 10px;
color: var(--primary);
}
.stat-card.accuracy .stat-icon {
color: var(--secondary);
}
.stat-card.time .stat-icon {
color: #f59e0b;
}
.stat-card.errors .stat-icon {
color: var(--danger);
}
.stat-value {
font-size: 2.5rem;
font-weight: 700;
margin-bottom: 5px;
color: var(--dark);
}
.stat-label {
font-size: 1rem;
color: var(--gray);
font-weight: 500;
}
.controls {
display: flex;
justify-content: center;
gap: 20px;
margin-top: 20px;
}
.result-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.7);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
opacity: 0;
visibility: hidden;
transition: var(--transition);
}
.result-modal.show {
opacity: 1;
visibility: visible;
}
.modal-content {
background-color: white;
border-radius: 16px;
padding: 40px;
max-width: 500px;
width: 90%;
text-align: center;
transform: scale(0.8);
transition: var(--transition);
}
.result-modal.show .modal-content {
transform: scale(1);
}
.result-title {
font-size: 2rem;
font-weight: 700;
margin-bottom: 20px;
color: var(--primary);
}
.result-stats {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 20px;
margin: 30px 0;
}
.result-stat {
padding: 15px;
background-color: var(--light);
border-radius: 10px;
}
.result-stat-value {
font-size: 1.8rem;
font-weight: 700;
color: var(--primary);
}
.result-stat-label {
color: var(--gray);
margin-top: 5px;
}
.close-modal {
background-color: var(--primary);
color: white;
border: none;
border-radius: 8px;
padding: 12px 25px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: var(--transition);
}
.close-modal:hover {
background-color: #4338ca;
}
.finger-guide {
display: flex;
justify-content: center;
gap: 15px;
margin-bottom: 15px;
flex-wrap: wrap;
}
.finger-item {
display: flex;
align-items: center;
gap: 5px;
font-size: 0.85rem;
color: var(--gray);
}
.finger-color {
width: 12px;
height: 12px;
border-radius: 50%;
}
.notification {
position: fixed;
top: 20px;
right: 20px;
padding: 15px 20px;
border-radius: 8px;
color: white;
font-weight: 500;
box-shadow: var(--shadow);
z-index: 2000;
transform: translateX(150%);
transition: transform 0.3s ease;
}
.notification.show {
transform: translateX(0);
}
.notification.success {
background-color: var(--secondary);
}
.notification.error {
background-color: var(--danger);
}
.notification.info {
background-color: var(--primary);
}
/* Estilos para el panel de estadísticas */
.stats-panel {
display: none;
}
.stats-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 30px;
padding-bottom: 15px;
border-bottom: 1px solid var(--gray-light);
}
.stats-title {
font-size: 1.8rem;
font-weight: 600;
color: var(--primary);
}
.stats-content {
background-color: white;
border-radius: 12px;
padding: 25px;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}
.stats-summary {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin-bottom: 30px;
}
.stats-history {
margin-top: 30px;
}
.history-table {
width: 100%;
border-collapse: collapse;
}
.history-table th, .history-table td {
padding: 12px 15px;
text-align: left;
border-bottom: 1px solid var(--gray-light);
}
.history-table th {
background-color: var(--light);
font-weight: 600;
color: var(--dark);
}
.history-table tr:hover {
background-color: rgba(79, 70, 229, 0.05);
}
.print-btn {
background-color: var(--secondary);
}
.print-btn:hover {
background-color: #0d9488;
}
/* Estilos para la impresión */
@media print {
body * {
visibility: hidden;
}
.print-area, .print-area * {
visibility: visible;
}
.print-area {
position: absolute;
left: 0;
top: 0;
width: 100%;
}
}
/* Formulario de registro */
.register-form {
display: none;
}
.register-title {
font-size: 2rem;
font-weight: 700;
margin-bottom: 30px;
text-align: center;
color: var(--primary);
}
.login-register-toggle {
text-align: center;
margin-top: 20px;
}
.login-register-toggle a {
color: var(--primary);
text-decoration: none;
font-weight: 500;
}
.login-register-toggle a:hover {
text-decoration: underline;
}

/* Estilos para el sistema de gestión de alumnos */
.admin-section {
background: white;
border-radius: 12px;
padding: 20px;
margin-bottom: 30px;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.section-actions {
display: flex;
gap: 10px;
margin-bottom: 20px;
}

.student-item {
background: var(--light);
border-radius: 8px;
padding: 15px;
margin-bottom: 10px;
display: flex;
justify-content: space-between;
align-items: center;
border-left: 4px solid var(--primary);
}

.student-info {
flex: 1;
}

.student-name {
font-size: 1.1rem;
font-weight: 600;
color: var(--primary);
}

.student-code {
font-family: monospace;
font-size: 1rem;
color: var(--gray);
margin-top: 5px;
}

.student-actions {
display: flex;
gap: 5px;
}

.btn-sm {
padding: 6px 10px;
font-size: 0.8rem;
}

.student-form {
background-color: var(--light);
border-radius: 12px;
padding: 25px;
margin-bottom: 30px;
display: none;
}

.student-form.active {
display: block;
}

.student-stats {
display: flex;
gap: 20px;
margin-top: 20px;
padding: 15px;
background: var(--light);
border-radius: 8px;
}

.student-stats p {
margin: 0;
}

.student-stats span {
font-weight: 600;
color: var(--primary);
}

/* Estilos para el botón inferior de nueva lección en el panel de administrador */
#admin-lesson-btn-bottom {
position: fixed;
bottom: 30px;
right: 30px;
width: auto;
padding: 15px 25px;
border-radius: 50px;
box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
z-index: 100;
display: none;
}

/* Estilos para el indicador de arrastre */
.drag-handle {
position: absolute;
top: 15px;
right: 15px;
color: var(--gray);
cursor: move;
font-size: 1.2rem;
opacity: 0.7;
}

.drag-handle:hover {
color: var(--primary);
opacity: 1;
}

.lesson-number {
position: absolute;
top: 15px;
left: 15px;
background-color: var(--primary);
color: white;
width: 30px;
height: 30px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-weight: bold;
font-size: 0.9rem;
}

@media (max-width: 768px) {
.app-header h1 {
font-size: 2rem;
}

.text-display {
font-size: 1.4rem;
padding: 15px;
}

.key {
min-width: 28px;
padding: 8px;
font-size: 0.75rem;
margin: 0 1px;
}

.key.space {
min-width: 120px;
}

.keyboard-row {
margin-bottom: 4px;
}

.typing-area {
padding: 15px;
}

.main-content {
padding: 20px;
}

.lesson-card-header {
flex-direction: column;
align-items: flex-start;
gap: 10px;
}

.lesson-actions {
width: 100%;
}

.form-actions {
flex-direction: column;
}

.lesson-selector {
flex-direction: column;
align-items: flex-start;
gap: 10px;
}

.stats-summary {
grid-template-columns: 1fr;
}

.history-table {
font-size: 0.9rem;
}

.history-table th, .history-table td {
padding: 8px 10px;
}

#admin-lesson-btn-bottom {
bottom: 20px;
right: 20px;
padding: 12px 20px;
}
}
</style>
</head>
<body>
<div class="app-container">
<div class="app-header">
<h1>Thames Centre Typing Master</h1>
<p>Mejora tu velocidad y precisión al escribir</p>
</div>

<!-- Pantalla de Login -->
<div id="login-screen" class="main-content">
<div class="login-container">
<!-- Formulario de Login -->
<div id="login-form" class="login-form">
<h2 class="login-title">Acceso al Sistema</h2>
<p class="login-subtitle" id="login-subtitle">Si eres alumno de Thames Centre, introduce tu nombre y código</p>

<div class="user-type">
<button id="student-btn" class="active">Alumno</button>
<button id="admin-btn">Administrador</button>
</div>

<div id="admin-password" class="form-group" style="display: none;">
<label for="password">Contraseña</label>
<input type="password" id="password" placeholder="Introduce la contraseña">
</div>

<div id="student-login" class="form-group">
<label for="student-name">Nombre</label>
<input type="text" id="student-name" placeholder="Introduce tu nombre">
</div>

<div id="student-code" class="form-group">
<label for="student-code-input">Código</label>
<input type="text" id="student-code-input" class="access-code-input" placeholder="Introduce tu código">
</div>

<div class="login-options">
<button id="access-btn" class="btn">
<i class="fas fa-sign-in-alt"></i> Acceder
</button>
<button id="exit-btn" class="btn btn-secondary">
<i class="fas fa-times"></i> Salir
</button>
</div>
</div>
</div>
</div>

<!-- Panel de Administrador -->
<div id="admin-panel" class="main-content admin-panel">
<div class="admin-header">
<h2 class="admin-title">Panel de Administración</h2>
<button id="logout-admin" class="btn btn-secondary">
<i class="fas fa-sign-out-alt"></i> Cerrar Sesión
</button>
</div>

<!-- Gestión de Lecciones -->
<div class="lessons-container">
<div class="lessons-header">
<h3 class="lessons-title">Gestión de Lecciones</h3>
<button id="new-lesson-btn" class="btn">
<i class="fas fa-plus"></i> Nueva Lección
</button>
</div>

<div id="lessons-list">
<!-- Las lecciones se cargarán dinámicamente -->
</div>

<div id="lesson-form" class="lesson-form">
<h3 id="form-title">Nueva Lección</h3>

<div class="form-group">
<label for="lesson-title-input">Título</label>
<input type="text" id="lesson-title-input" placeholder="Título de la lección">
</div>

<div class="form-group">
<label for="lesson-level-input">Nivel</label>
<select id="lesson-level-input">
<option value="1">1 estrella</option>
<option value="2">2 estrellas</option>
<option value="3">3 estrellas</option>
</select>
</div>

<div class="form-group">
<label for="lesson-content-input">Contenido</label>
<textarea id="lesson-content-input" placeholder="Texto de la lección"></textarea>
</div>

<div class="form-actions">
<button id="save-lesson-btn" class="btn">
<i class="fas fa-save"></i> Guardar
</button>
<button id="cancel-lesson-btn" class="btn btn-secondary">
<i class="fas fa-times"></i> Cancelar
</button>
</div>
</div>
</div>

<!-- Gestión de Alumnos -->
<div class="admin-section">
<h3 class="lessons-title">Gestión de Alumnos</h3>
<div class="section-actions">
<button id="add-student-btn" class="btn">
<i class="fas fa-user-plus"></i> Añadir Alumno
</button>
<button id="view-students-btn" class="btn btn-secondary">
<i class="fas fa-list"></i> Ver Alumnos
</button>
</div>

<div id="students-management" style="display: none;">
<div class="students-list"></div>
<div class="student-stats">
<p>Total de alumnos: <span id="total-students">0</span></p>
</div>
</div>

<div id="student-form" class="student-form">
<h3 id="student-form-title">Añadir Alumno</h3>

<div class="form-group">
<label for="student-username-input">Nombre de usuario</label>
<input type="text" id="student-username-input" placeholder="Nombre de usuario para el alumno">
</div>

<div class="form-group">
<label for="student-code-input">Código de acceso</label>
<input type="text" id="student-code-input" class="access-code-input" placeholder="Código de acceso para el alumno">
</div>

<div class="form-actions">
<button id="save-student-btn" class="btn">
<i class="fas fa-save"></i> Guardar
</button>
<button id="cancel-student-btn" class="btn btn-secondary">
<i class="fas fa-times"></i> Cancelar
</button>
</div>
</div>
</div>

<!-- Cambiar Contraseña de Administrador -->
<div class="admin-section">
<h3 class="lessons-title">Cambiar Contraseña de Administrador</h3>
<div class="form-group">
<label for="current-password">Contraseña Actual</label>
<input type="password" id="current-password" placeholder="Introduce la contraseña actual">
</div>
<div class="form-group">
<label for="new-password">Nueva Contraseña</label>
<input type="password" id="new-password" placeholder="Introduce la nueva contraseña">
</div>
<div class="form-group">
<label for="confirm-password">Confirmar Nueva Contraseña</label>
<input type="password" id="confirm-password" placeholder="Confirma la nueva contraseña">
</div>
<div class="form-actions">
<button id="change-password-btn" class="btn">
<i class="fas fa-save"></i> Cambiar Contraseña
</button>
</div>
</div>

<!-- Botón flotante inferior de nueva lección para el panel de administrador -->
<button id="admin-lesson-btn-bottom" class="btn">
<i class="fas fa-plus"></i> Nueva Lección
</button>
</div>

<!-- Panel de Alumno -->
<div id="student-panel" class="main-content student-panel">
<div class="lesson-info">
<div class="lesson-selector">
<select id="lesson-select">
<!-- Las lecciones se cargarán dinámicamente -->
</select>
<div class="lesson-title" id="current-lesson-title">Lección 1: Fila central (ASDF JKL;)</div>
</div>
<div class="lesson-level">
<span>Nivel:</span>
<div class="stars" id="current-lesson-stars">
<i class="fas fa-star"></i>
<i class="far fa-star"></i>
<i class="far fa-star"></i>
</div>
</div>
</div>

<div class="progress-bar">
<div class="progress" id="progress"></div>
</div>

<div class="typing-area">
<div id="text-display" class="text-display" tabindex="0"></div>

<div class="finger-guide">
<div class="finger-item">
<div class="finger-color" style="background-color: var(--left-pinky-color)"></div>
<span>Meñique izq.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--left-ring-color)"></div>
<span>Anular izq.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--left-middle-color)"></div>
<span>Corazón izq.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--left-index-color)"></div>
<span>Índice izq.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--right-index-color)"></div>
<span>Índice der.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--right-middle-color)"></div>
<span>Corazón der.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--right-ring-color)"></div>
<span>Anular der.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--right-pinky-color)"></div>
<span>Meñique der.</span>
</div>
<div class="finger-item">
<div class="finger-color" style="background-color: var(--thumb-color)"></div>
<span>Pulgar</span>
</div>
</div>

<div class="keyboard-container">
<!-- Teclado Español - Fila 1 -->
<div class="keyboard-row key-large-symbols">
<button class="key left-pinky" data-key="º">
<span class="key-char-top">ª</span>
<span class="key-char-main">º</span>
<span class="key-char-bottom-right">\</span>
</button>
<button class="key left-pinky" data-key="1">
<span class="key-char-top">!</span>
<span class="key-char-main">1</span>
<span class="key-char-bottom-right">|</span>
</button>
<button class="key left-ring" data-key="2">
<span class="key-char-top">"</span>
<span class="key-char-main">2</span>
<span class="key-char-bottom-right">@</span>
</button>
<button class="key left-middle" data-key="3">
<span class="key-char-top">·</span>
<span class="key-char-main">3</span>
<span class="key-char-bottom-right">#</span>
</button>
<button class="key left-index" data-key="4">
<span class="key-char-top">$</span>
<span class="key-char-main">4</span>
</button>
<button class="key left-index" data-key="5">
<span class="key-char-top">%</span>
<span class="key-char-main">5</span>
</button>
<button class="key right-index" data-key="6">
<span class="key-char-top">&</span>
<span class="key-char-main">6</span>
</button>
<button class="key right-index" data-key="7">
<span class="key-char-top">/</span>
<span class="key-char-main">7</span>
</button>
<button class="key right-middle" data-key="8">
<span class="key-char-top">(</span>
<span class="key-char-main">8</span>
</button>
<button class="key right-ring" data-key="9">
<span class="key-char-top">)</span>
<span class="key-char-main">9</span>
</button>
<button class="key right-pinky" data-key="0">
<span class="key-char-top">=</span>
<span class="key-char-main">0</span>
</button>
<button class="key right-pinky" data-key="'">
<span class="key-char-top">?</span>
<span class="key-char-main">'</span>
</button>
<button class="key right-pinky" data-key="¡">
<span class="key-char-top">¿</span>
<span class="key-char-main">¡</span>
</button>
<button class="key right-pinky key-wide" data-key="Backspace">
<span class="key-char-main"><i class="fas fa-backspace"></i></span>
</button>
</div>

<!-- Teclado Español - Fila 2 -->
<div class="keyboard-row">
<button class="key left-pinky key-wide" data-key="Tab">
<span class="key-char-main">Tab</span>
</button>
<button class="key left-pinky" data-key="q">
<span class="key-char-main">Q</span>
</button>
<button class="key left-ring" data-key="w">
<span class="key-char-main">W</span>
</button>
<button class="key left-middle" data-key="e">
<span class="key-char-main">E</span>
</button>
<button class="key left-index" data-key="r">
<span class="key-char-main">R</span>
</button>
<button class="key left-index" data-key="t">
<span class="key-char-main">T</span>
</button>
<button class="key right-index" data-key="y">
<span class="key-char-main">Y</span>
</button>
<button class="key right-index" data-key="u">
<span class="key-char-main">U</span>
</button>
<button class="key right-middle" data-key="i">
<span class="key-char-main">I</span>
</button>
<button class="key right-ring" data-key="o">
<span class="key-char-main">O</span>
</button>
<button class="key right-pinky" data-key="p">
<span class="key-char-main">P</span>
</button>
<button class="key right-pinky" data-key="`">
<span class="key-char-top">^</span>
<span class="key-char-main">`</span>
<span class="key-char-bottom-right">[</span>
</button>
<!-- TECLA CORREGIDA: Asterisco -->
<button class="key right-pinky" data-key="*">
<span class="key-char-top">*</span>
<span class="key-char-main">+</span>
<span class="key-char-bottom-right">]</span>
</button>
</div>

<!-- Teclado Español - Fila 3 -->
<div class="keyboard-row">
<button class="key left-pinky key-xwide" data-key="CapsLock">
<span class="key-char-main">Bloq<br>Mayús</span>
</button>
<button class="key left-pinky" data-key="a">
<span class="key-char-main">A</span>
</button>
<button class="key left-ring" data-key="s">
<span class="key-char-main">S</span>
</button>
<button class="key left-middle" data-key="d">
<span class="key-char-main">D</span>
</button>
<button class="key left-index" data-key="f">
<span class="key-char-main">F</span>
</button>
<button class="key left-index" data-key="g">
<span class="key-char-main">G</span>
</button>
<button class="key right-index" data-key="h">
<span class="key-char-main">H</span>
</button>
<button class="key right-index" data-key="j">
<span class="key-char-main">J</span>
</button>
<button class="key right-middle" data-key="k">
<span class="key-char-main">K</span>
</button>
<button class="key right-ring" data-key="l">
<span class="key-char-main">L</span>
</button>
<button class="key right-pinky" data-key="ñ">
<span class="key-char-main">Ñ</span>
</button>
<!-- TECLA CORREGIDA: Diéresis -->
<button class="key right-pinky key-large-symbols" data-key="´">
<span class="key-char-top">¨</span>
<span class="key-char-main">´</span>
<span class="key-char-bottom-right">{</span>
</button>
<!-- TECLA CORREGIDA: Ç -->
<button class="key right-pinky" data-key="ç">
<span class="key-char-top">Ç</span>
<span class="key-char-main">ç</span>
<span class="key-char-bottom-right">}</span>
</button>
<button class="key right-pinky key-enter" data-key="Enter">
<span class="key-char-main">Intro</span>
</button>
</div>

<!-- Teclado Español - Fila 4 -->
<div class="keyboard-row">
<button class="key left-pinky key-shift" data-key="Shift">
<span class="key-char-main">Mayús</span>
</button>
<button class="key left-pinky" data-key="<">
<span class="key-char-top">></span>
<span class="key-char-main">&lt;</span>
</button>
<button class="key left-pinky" data-key="z">
<span class="key-char-main">Z</span>
</button>
<button class="key left-ring" data-key="x">
<span class="key-char-main">X</span>
</button>
<button class="key left-middle" data-key="c">
<span class="key-char-main">C</span>
</button>
<button class="key left-index" data-key="v">
<span class="key-char-main">V</span>
</button>
<button class="key left-index" data-key="b">
<span class="key-char-main">B</span>
</button>
<button class="key right-index" data-key="n">
<span class="key-char-main">N</span>
</button>
<button class="key right-index" data-key="m">
<span class="key-char-main">M</span>
</button>
<button class="key right-middle" data-key=",">
<span class="key-char-top">;</span>
<span class="key-char-main">,</span>
</button>
<button class="key right-ring" data-key=".">
<span class="key-char-top">:</span>
<span class="key-char-main">.</span>
</button>
<button class="key right-pinky" data-key="-">
<span class="key-char-top">_</span>
<span class="key-char-main">-</span>
</button>
<button class="key right-pinky key-shift" data-key="Shift">
<span class="key-char-main">Mayús</span>
</button>
</div>

<!-- Teclado Español - Fila 5 -->
<div class="keyboard-row">
<button class="key left-pinky key-wide" data-key="Control">
<span class="key-char-main">Ctrl</span>
</button>
<button class="key thumb key-wide" data-key="Alt">
<span class="key-char-main">Alt</span>
</button>
<button class="key thumb key-space" data-key=" ">
<span class="key-char-main">Espacio</span>
</button>
<button class="key thumb key-wide" data-key="AltGraph">
<span class="key-char-main">Alt Gr</span>
</button>
<button class="key right-pinky key-wide" data-key="Control">
<span class="key-char-main">Ctrl</span>
</button>
</div>
</div>
</div>

<div class="stats-container">
<div class="stat-card">
<div class="stat-icon"><i class="fas fa-tachometer-alt"></i></div>
<div class="stat-value" id="wpm">0</div>
<div class="stat-label">Palabras por minuto</div>
</div>

<div class="stat-card accuracy">
<div class="stat-icon"><i class="fas fa-bullseye"></i></div>
<div class="stat-value" id="accuracy">100%</div>
<div class="stat-label">Precisión</div>
</div>

<div class="stat-card time">
<div class="stat-icon"><i class="fas fa-clock"></i></div>
<div class="stat-value" id="time">0:00</div>
<div class="stat-label">Tiempo</div>
</div>

<div class="stat-card errors">
<div class="stat-icon"><i class="fas fa-times-circle"></i></div>
<div class="stat-value" id="errors">0</div>
<div class="stat-label">Errores</div>
</div>
</div>

<div class="controls">
<button class="btn" id="restart-btn">
<i class="fas fa-redo"></i> Reiniciar
</button>
<button class="btn btn-secondary" id="stats-btn">
<i class="fas fa-chart-bar"></i> Estadísticas
</button>
<button class="btn btn-secondary" id="logout-student">
<i class="fas fa-sign-out-alt"></i> Cerrar Sesión
</button>
</div>
</div>
</div>

<!-- Panel de Estadísticas -->
<div id="stats-panel" class="main-content stats-panel">
<div class="stats-header">
<h2 class="stats-title">Estadísticas de Progreso</h2>
<button id="back-to-typing" class="btn btn-secondary">
<i class="fas fa-arrow-left"></i> Volver
</button>
</div>

<div class="stats-content print-area">
<div class="stats-summary">
<div class="stat-card">
<div class="stat-icon"><i class="fas fa-book"></i></div>
<div class="stat-value" id="total-lessons">0</div>
<div class="stat-label">Lecciones Completadas</div>
</div>

<div class="stat-card">
<div class="stat-icon"><i class="fas fa-tachometer-alt"></i></div>
<div class="stat-value" id="avg-wpm">0</div>
<div class="stat-label">Velocidad Promedio (PPM)</div>
</div>

<div class="stat-card accuracy">
<div class="stat-icon"><i class="fas fa-bullseye"></i></div>
<div class="stat-value" id="avg-accuracy">0%</div>
<div class="stat-label">Precisión Promedio</div>
</div>

<div class="stat-card errors">
<div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
<div class="stat-value" id="total-errors">0</div>
<div class="stat-label">Total de Errores</div>
</div>
</div>

<div class="stats-history">
<h3 class="lessons-title">Historial de Lecciones</h3>
<table class="history-table">
<thead>
<tr>
<th>Lección</th>
<th>Fecha</th>
<th>Velocidad (PPM)</th>
<th>Precisión</th>
<th>Errores</th>
<th>Tiempo</th>
</tr>
</thead>
<tbody id="history-table-body">
<!-- Las estadísticas se cargarán dinámicamente -->
</tbody>
</table>
</div>

<div class="controls">
<button class="btn print-btn" id="print-stats">
<i class="fas fa-print"></i> Imprimir Estadísticas
</button>
</div>
</div>
</div>

<div class="result-modal" id="result-modal">
<div class="modal-content">
<h2 class="result-title">¡Lección Completada!</h2>
<div class="result-stats">
<div class="result-stat">
<div class="result-stat-value" id="final-wpm">0</div>
<div class="result-stat-label">Palabras por minuto</div>
</div>
<div class="result-stat">
<div class="result-stat-value" id="final-accuracy">0%</div>
<div class="result-stat-label">Precisión</div>
</div>
<div class="result-stat">
<div class="result-stat-value" id="final-time">0:00</div>
<div class="result-stat-label">Tiempo</div>
</div>
<div class="result-stat">
<div class="result-stat-value" id="final-errors">0</div>
<div class="result-stat-label">Errores</div>
</div>
</div>
<button class="close-modal" id="close-modal">Continuar</button>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
// Variables globales
let currentUser = null;
let lessons = [];
let currentLesson = null;
let currentIndex = 0;
let startTime = null;
let correctChars = 0;
let incorrectChars = 0;
let timerInterval = null;
let totalErrors = 0;
let exerciseCompleted = false;
let editingLessonId = null;
let users = [];
let userStats = [];
let draggedElement = null; // Elemento arrastrado
let editingStudentId = null;
let adminPassword = "admin123"; // Contraseña por defecto
let userInput = ''; // Almacena el texto que el usuario ha escrito
let typingActive = false; // Indica si estamos en modo escritura

// Elementos del DOM
const loginScreen = document.getElementById('login-screen');
const adminPanel = document.getElementById('admin-panel');
const studentPanel = document.getElementById('student-panel');
const statsPanel = document.getElementById('stats-panel');
const loginForm = document.getElementById('login-form');
const loginSubtitle = document.getElementById('login-subtitle');
const studentBtn = document.getElementById('student-btn');
const adminBtn = document.getElementById('admin-btn');
const adminPasswordDiv = document.getElementById('admin-password');
const passwordInput = document.getElementById('password');
const studentLoginDiv = document.getElementById('student-login');
const studentCodeDiv = document.getElementById('student-code');
const studentNameInput = document.getElementById('student-name');
const studentCodeInput = document.getElementById('student-code-input');
const accessBtn = document.getElementById('access-btn');
const exitBtn = document.getElementById('exit-btn');
const logoutAdminBtn = document.getElementById('logout-admin');
const logoutStudentBtn = document.getElementById('logout-student');
const statsBtn = document.getElementById('stats-btn');
const backToTyping = document.getElementById('back-to-typing');
const printStats = document.getElementById('print-stats');
const newLessonBtn = document.getElementById('new-lesson-btn');
const adminLessonBtnBottom = document.getElementById('admin-lesson-btn-bottom');
const addStudentBtn = document.getElementById('add-student-btn');
const viewStudentsBtn = document.getElementById('view-students-btn');
const studentsManagement = document.getElementById('students-management');
const studentForm = document.getElementById('student-form');
const studentFormTitle = document.getElementById('student-form-title');
const studentUsernameInput = document.getElementById('student-username-input');
const studentCodeInputAdmin = document.getElementById('student-code-input');
const saveStudentBtn = document.getElementById('save-student-btn');
const cancelStudentBtn = document.getElementById('cancel-student-btn');
const lessonForm = document.getElementById('lesson-form');
const formTitle = document.getElementById('form-title');
const lessonTitleInput = document.getElementById('lesson-title-input');
const lessonLevelInput = document.getElementById('lesson-level-input');
const lessonContentInput = document.getElementById('lesson-content-input');
const saveLessonBtn = document.getElementById('save-lesson-btn');
const cancelLessonBtn = document.getElementById('cancel-lesson-btn');
const lessonsList = document.getElementById('lessons-list');
const lessonSelect = document.getElementById('lesson-select');
const currentLessonTitle = document.getElementById('current-lesson-title');
const currentLessonStars = document.getElementById('current-lesson-stars');
const textDisplay = document.getElementById('text-display');
const wpmDisplay = document.getElementById('wpm');
const accuracyDisplay = document.getElementById('accuracy');
const timeDisplay = document.getElementById('time');
const errorsDisplay = document.getElementById('errors');
const progressDisplay = document.getElementById('progress');
const restartBtn = document.getElementById('restart-btn');
const resultModal = document.getElementById('result-modal');
const closeModalBtn = document.getElementById('close-modal');
const finalWpm = document.getElementById('final-wpm');
const finalAccuracy = document.getElementById('final-accuracy');
const finalTime = document.getElementById('final-time');
const finalErrors = document.getElementById('final-errors');
const totalLessons = document.getElementById('total-lessons');
const avgWpm = document.getElementById('avg-wpm');
const avgAccuracy = document.getElementById('avg-accuracy');
const totalErrorsStat = document.getElementById('total-errors');
const historyTableBody = document.getElementById('history-table-body');

// Inicializar datos
function initializeApp() {
// Cargar contraseña de administrador
const savedAdminPassword = localStorage.getItem('adminPassword');
if (savedAdminPassword) {
adminPassword = savedAdminPassword;
} else {
// Establecer contraseña por defecto si no existe
adminPassword = "admin123";
localStorage.setItem('adminPassword', adminPassword);
}

// Cargar usuarios (alumnos)
users = loadUsers();

// Si no hay usuarios, crear un usuario de prueba
if (users.length === 0) {
users = [
{
id: 1,
username: "demo",
code: "DEMO123"
// Ya no se incluye la contraseña
}
];
saveUsers();
}

// Cargar lecciones
lessons = loadLessons();

// Cargar estadísticas
userStats = loadUserStats();
}

// Función para generar texto repetitivo de manera segura
function generateRepetitiveText(baseText, repetitions) {
let result = '';
for (let i = 0; i < repetitions; i++) {
result += baseText + ' ';
}
return result.trim();
}

// Inicializar lecciones basadas en el manual de mecanografía
function initializeDefaultLessons() {
const defaultLessons = [
{
id: 1,
title: "Lección 1: Fila central (ASDF JKL;)",
level: 1,
content: generateRepetitiveText("asdf jkl;", 50),
order: 1
},
{
id: 2,
title: "Lección 2: Fila central combinada",
level: 1,
content: generateRepetitiveText("asdf jkl; fdsa lkj", 40),
order: 2
},
{
id: 3,
title: "Lección 3: Palabras con fila central",
level: 1,
content: "sala laña gala faja gasas hada añada agallas alhajas lasaña salada dala salsa al hada las gafas falsas añadas las gasas la faja hallada la flaka da sal la falla fallada",
order: 3
},
{
id: 4,
title: "Lección 4: Fila superior (QWERTY)",
level: 2,
content: generateRepetitiveText("qwerty poiuy", 30),
order: 4
},
{
id: 5,
title: "Lección 5: Combinación filas central y superior",
level: 2,
content: generateRepetitiveText("asdwert lkjoiuy", 25),
order: 5
},
{
id: 6,
title: "Lección 6: Palabras con fila superior",
level: 2,
content: "quiero perrito puerto torero querer tutor torito yute potrito pitorro retrete portero porque yo te quiero torero y porquero",
order: 6
},
{
id: 7,
title: "Lección 7: Fila inferior (ZXCVBNM)",
level: 2,
content: generateRepetitiveText("zxcvb nm,./", 30),
order: 7
},
{
id: 8,
title: "Lección 8: Combinación de todas las filas",
level: 3,
content: "El rápido zorro marrón salta sobre el perro perezoso. Esta frase contiene todas las letras del alfabeto español.",
order: 8
},
{
id: 9,
title: "Lección 9: Puntuación básica",
level: 3,
content: "Hola, ¿cómo estás? Bien, gracias. ¿Y tú? Muy bien, gracias por preguntar. ¡Hasta luego!",
order: 9
},
{
id: 10,
title: "Lección 10: Números y símbolos",
level: 3,
content: "1234567890 !@#$%^&*()_+-=[]{}|;':\",./<>?",
order: 10
}
];

saveLessons(defaultLessons);
return defaultLessons;
}

// Funciones para guardar y cargar datos
function saveLessons(lessonsToSave = lessons) {
localStorage.setItem('typingLessons', JSON.stringify(lessonsToSave));
}

function loadLessons() {
const savedLessons = localStorage.getItem('typingLessons');
if (savedLessons) {
return JSON.parse(savedLessons);
} else {
return initializeDefaultLessons();
}
}

function saveUsers() {
localStorage.setItem('typingUsers', JSON.stringify(users));
}

function loadUsers() {
const savedUsers = localStorage.getItem('typingUsers');
if (savedUsers) {
const parsedUsers = JSON.parse(savedUsers);
// Si los usuarios tienen el campo password, lo eliminamos
return parsedUsers.map(user => {
const { password, ...rest } = user;
return rest;
});
} else {
return [];
}
}

function saveUserStats() {
localStorage.setItem('typingUserStats', JSON.stringify(userStats));
}

function loadUserStats() {
const savedStats = localStorage.getItem('typingUserStats');
return savedStats ? JSON.parse(savedStats) : [];
}

// Funciones de notificación
function showNotification(message, type = 'info') {
const notification = document.createElement('div');
notification.className = `notification ${type}`;
notification.textContent = message;
document.body.appendChild(notification);

setTimeout(() => {
notification.classList.add('show');
}, 10);

setTimeout(() => {
notification.classList.remove('show');
setTimeout(() => {
document.body.removeChild(notification);
}, 300);
}, 3000);
}

// Funciones para el panel de administración
function renderLessons() {
lessonsList.innerHTML = '';

// Ordenar lecciones por orden
lessons.sort((a, b) => a.order - b.order);

lessons.forEach((lesson, index) => {
const lessonCard = document.createElement('div');
lessonCard.className = 'lesson-card';
lessonCard.draggable = true;
lessonCard.dataset.lessonId = lesson.id;
lessonCard.dataset.lessonOrder = lesson.order;

lessonCard.innerHTML = `
<div class="lesson-number">${index + 1}</div>
<div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
<div class="lesson-card-header">
<div class="lesson-card-title">${lesson.title}</div>
<div class="lesson-level">
<span>Nivel:</span>
<div class="stars">
${renderStars(lesson.level)}
</div>
</div>
</div>
<div class="lesson-content">${lesson.content.substring(0, 100)}${lesson.content.length > 100 ? '...' : ''}</div>
<div class="lesson-actions">
<button class="btn btn-sm" data-id="${lesson.id}" data-action="edit">
<i class="fas fa-edit"></i> Editar
</button>
<button class="btn btn-sm btn-danger" data-id="${lesson.id}" data-action="delete">
<i class="fas fa-trash"></i> Eliminar
</button>
</div>
`;

lessonsList.appendChild(lessonCard);
});

// Añadir eventos de arrastre
addDragAndDropEvents();

// Añadir eventos a los botones de acción
document.querySelectorAll('.lesson-actions button').forEach(button => {
button.addEventListener('click', handleLessonAction);
});
}

function renderStars(level) {
let stars = '';
for (let i = 1; i <= 3; i++) {
stars += i <= level ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>';
}
return stars;
}

function handleLessonAction(e) {
const action = e.currentTarget.dataset.action;
const lessonId = parseInt(e.currentTarget.dataset.id);

if (action === 'edit') {
editLesson(lessonId);
} else if (action === 'delete') {
deleteLesson(lessonId);
}
}

function editLesson(lessonId) {
const lesson = lessons.find(l => l.id === lessonId);
if (lesson) {
editingLessonId = lessonId;
formTitle.textContent = 'Editar Lección';
lessonTitleInput.value = lesson.title;
lessonLevelInput.value = lesson.level;
lessonContentInput.value = lesson.content;
lessonForm.classList.add('active');
}
}

function deleteLesson(lessonId) {
if (confirm('¿Estás seguro de que quieres eliminar esta lección?')) {
lessons = lessons.filter(l => l.id !== lessonId);
saveLessons();
renderLessons();
showNotification('Lección eliminada correctamente', 'success');
}
}

// Funciones para arrastrar y soltar lecciones
function addDragAndDropEvents() {
const lessonCards = document.querySelectorAll('.lesson-card');

lessonCards.forEach(card => {
card.addEventListener('dragstart', handleDragStart);
card.addEventListener('dragover', handleDragOver);
card.addEventListener('drop', handleDrop);
card.addEventListener('dragend', handleDragEnd);
});
}

function handleDragStart(e) {
draggedElement = e.currentTarget;
e.currentTarget.classList.add('dragging');
}

function handleDragOver(e) {
e.preventDefault();
const afterElement = getDragAfterElement(lessonsList, e.clientY);
const dragging = document.querySelector('.dragging');
if (afterElement == null) {
lessonsList.appendChild(dragging);
} else {
lessonsList.insertBefore(dragging, afterElement);
}
}

function handleDrop(e) {
e.preventDefault();
updateLessonsOrder();
}

function handleDragEnd(e) {
e.currentTarget.classList.remove('dragging');
}

function getDragAfterElement(container, y) {
const draggableElements = [...container.querySelectorAll('.lesson-card:not(.dragging)')];

return draggableElements.reduce((closest, child) => {
const box = child.getBoundingClientRect();
const offset = y - box.top - box.height / 2;

if (offset < 0 && offset > closest.offset) {
return { offset: offset, element: child };
} else {
return closest;
}
}, { offset: Number.NEGATIVE_INFINITY }).element;
}

function updateLessonsOrder() {
const lessonCards = document.querySelectorAll('.lesson-card');
lessonCards.forEach((card, index) => {
const lessonId = parseInt(card.dataset.lessonId);
const lesson = lessons.find(l => l.id === lessonId);
if (lesson) {
lesson.order = index + 1;
}
});
saveLessons();
renderLessons();
}

// Funciones para la gestión de alumnos
function renderStudents() {
const studentsList = document.querySelector('.students-list');
studentsList.innerHTML = '';

if (users.length === 0) {
studentsList.innerHTML = '<p>No hay alumnos registrados.</p>';
document.getElementById('total-students').textContent = '0';
return;
}

users.forEach(student => {
const studentItem = document.createElement('div');
studentItem.className = 'student-item';
studentItem.innerHTML = `
<div class="student-info">
<div class="student-name">${student.username}</div>
<div class="student-code">Código: ${student.code}</div>
</div>
<div class="student-actions">
<button class="btn btn-sm" data-id="${student.id}" data-action="edit">
<i class="fas fa-edit"></i>
</button>
<button class="btn btn-sm btn-danger" data-id="${student.id}" data-action="delete">
<i class="fas fa-trash"></i>
</button>
</div>
`;
studentsList.appendChild(studentItem);
});

document.getElementById('total-students').textContent = users.length;

// Añadir eventos a los botones
document.querySelectorAll('.student-actions button').forEach(button => {
button.addEventListener('click', handleStudentAction);
});
}

function handleStudentAction(e) {
const action = e.currentTarget.dataset.action;
const studentId = parseInt(e.currentTarget.dataset.id);

if (action === 'edit') {
editStudent(studentId);
} else if (action === 'delete') {
deleteStudent(studentId);
}
}

function editStudent(studentId) {
const student = users.find(u => u.id === studentId);
if (student) {
editingStudentId = studentId;
studentFormTitle.textContent = 'Editar Alumno';
studentUsernameInput.value = student.username;
studentCodeInputAdmin.value = student.code;
studentForm.classList.add('active');
}
}

function deleteStudent(studentId) {
if (confirm('¿Estás seguro de que quieres eliminar a este alumno?')) {
users = users.filter(u => u.id !== studentId);
saveUsers();
renderStudents();
showNotification('Alumno eliminado correctamente', 'success');
}
}

// Función para resaltar la tecla que debe presionarse
function highlightExpectedKey(char) {
    // Quitar la clase 'expected' de todas las teclas
    document.querySelectorAll('.key').forEach(key => {
        key.classList.remove('expected');
    });
    
    // Si no hay carácter esperado, no hacemos nada
    if (!char) return;
    
    // Buscar la tecla con data-key igual al carácter esperado
    const keyElement = document.querySelector(`.key[data-key="${char}"]`);
    if (keyElement) {
        keyElement.classList.add('expected');
    }
}

// Función para reiniciar completamente la lección
function resetLessonCompletely() {
    // Detener el timer si está corriendo
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    
    // Reiniciar variables
    currentIndex = 0;
    correctChars = 0;
    incorrectChars = 0;
    totalErrors = 0;
    userInput = '';
    typingActive = false;
    exerciseCompleted = false;
    
    // Reiniciar estadísticas
    resetStats();
    
    // Volver a renderizar la lección
    renderLesson();
    
    // Resaltar la primera tecla esperada
    if (currentLesson && currentLesson.content.length > 0) {
        highlightExpectedKey(currentLesson.content[0]);
    }
    
    // Resetear teclado
    document.querySelectorAll('.key').forEach(key => {
        key.classList.remove('active', 'correct', 'incorrect');
    });
}

// Funciones para el panel de estudiantes
function initLesson() {
currentLesson = lessons[0]; // Por defecto, la primera lección
if (lessonSelect.options.length > 0) {
currentLesson = lessons.find(lesson => lesson.id == lessonSelect.value);
}
currentIndex = 0;
correctChars = 0;
incorrectChars = 0;
totalErrors = 0;
userInput = '';
typingActive = false;
exerciseCompleted = false;

// Mostrar la lección en el área de texto
renderLesson();

// Resaltar la primera tecla esperada
if (currentLesson && currentLesson.content.length > 0) {
    highlightExpectedKey(currentLesson.content[0]);
}

// Resetear estadísticas
resetStats();

// Resetear teclado
document.querySelectorAll('.key').forEach(key => {
key.classList.remove('active', 'correct', 'incorrect');
});
}

function renderLesson() {
textDisplay.innerHTML = '';
if (!currentLesson) return;

const text = currentLesson.content;
for (let i = 0; i < text.length; i++) {
const char = document.createElement('span');
char.className = 'char';
char.textContent = text[i];
if (i === 0) {
char.classList.add('current');
}
textDisplay.appendChild(char);
}
}

function handleKeyDown(e) {
// Si el ejercicio está completado, no hacer nada
if (exerciseCompleted) return;

// Ignorar teclas de control como Alt, Ctrl, etc.
if (e.ctrlKey || e.altKey || e.metaKey) return;

// Si no se ha empezado a escribir, iniciar el cronómetro
if (!typingActive) {
startTimer();
typingActive = true;
}

const chars = textDisplay.querySelectorAll('.char');
if (chars.length === 0) return;

const currentChar = chars[currentIndex];
const expectedChar = currentChar.textContent;

// Manejar tecla de retroceso
if (e.key === 'Backspace') {
if (currentIndex > 0) {
// Retroceder un carácter
chars[currentIndex].classList.remove('current');
currentIndex--;
chars[currentIndex].classList.add('current');

// Si el carácter anterior era incorrecto, reducir el contador de errores
if (chars[currentIndex].classList.contains('incorrect')) {
incorrectChars--;
totalErrors--;
} else {
correctChars--;
}

// Quitar la clase de correcto o incorrecto
chars[currentIndex].classList.remove('correct', 'incorrect');

// Resaltar la nueva tecla esperada
highlightExpectedKey(chars[currentIndex].textContent);
}
updateStats();
return;
}

// Manejar tecla de espacio
if (e.key === ' ') {
e.preventDefault(); // Evitar el scroll
}

// Comparar la tecla presionada con el carácter esperado
if (e.key === expectedChar) {
// Carácter correcto
currentChar.classList.remove('current');
currentChar.classList.add('correct');
correctChars++;
currentIndex++;

// Si hay más caracteres, marcar el siguiente como actual
if (currentIndex < chars.length) {
chars[currentIndex].classList.add('current');
// Resaltar la siguiente tecla esperada
highlightExpectedKey(chars[currentIndex].textContent);
} else {
// Ejercicio completado
completeExercise();
}
} else {
// Carácter incorrecto
currentChar.classList.remove('current');
currentChar.classList.add('incorrect');
incorrectChars++;
totalErrors++;
currentIndex++;

// Si hay más caracteres, marcar el siguiente como actual
if (currentIndex < chars.length) {
chars[currentIndex].classList.add('current');
// Resaltar la siguiente tecla esperada
highlightExpectedKey(chars[currentIndex].textContent);
} else {
// Ejercicio completado
completeExercise();
}
}

// Actualizar el teclado visual
updateKeyboard(e.key, e.key === expectedChar);

// Actualizar estadísticas
updateStats();
}

function updateKeyboard(key, isCorrect) {
// Buscar la tecla correspondiente
const keyElement = document.querySelector(`.key[data-key="${key}"]`);
if (keyElement) {
// Quitar clases anteriores
keyElement.classList.remove('active', 'correct', 'incorrect');

// Añadir la clase correspondiente
if (isCorrect) {
keyElement.classList.add('correct');
} else {
keyElement.classList.add('incorrect');
}

// Simular la pulsación
keyElement.classList.add('active');

// Quitar la clase active después de un tiempo
setTimeout(() => {
keyElement.classList.remove('active');
}, 100);
}
}

function startTimer() {
startTime = Date.now();
timerInterval = setInterval(updateTimer, 1000);
}

function updateTimer() {
if (!startTime) return;

const elapsed = Math.floor((Date.now() - startTime) / 1000);
const minutes = Math.floor(elapsed / 60);
const seconds = elapsed % 60;

timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

function updateStats() {
// Calcular palabras por minuto (WPM)
const timeElapsed = startTime ? (Date.now() - startTime) / 1000 / 60 : 0; // en minutos
const wordsTyped = correctChars / 5; // Consideramos 5 caracteres por palabra
const wpm = timeElapsed > 0 ? Math.round(wordsTyped / timeElapsed) : 0;
wpmDisplay.textContent = wpm;

// Calcular precisión
const totalChars = correctChars + incorrectChars;
const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
accuracyDisplay.textContent = `${accuracy}%`;

// Actualizar errores
errorsDisplay.textContent = totalErrors;

// Actualizar barra de progreso
const progress = (currentIndex / textDisplay.querySelectorAll('.char').length) * 100;
progressDisplay.style.width = `${progress}%`;
}

function resetStats() {
wpmDisplay.textContent = '0';
accuracyDisplay.textContent = '100%';
timeDisplay.textContent = '0:00';
errorsDisplay.textContent = '0';
progressDisplay.style.width = '0%';

if (timerInterval) {
clearInterval(timerInterval);
timerInterval = null;
}
startTime = null;
}

function completeExercise() {
exerciseCompleted = true;
clearInterval(timerInterval);

// Quitar el resaltado de la tecla esperada
highlightExpectedKey(null);

// Mostrar resultados en el modal
finalWpm.textContent = wpmDisplay.textContent;
finalAccuracy.textContent = accuracyDisplay.textContent;
finalTime.textContent = timeDisplay.textContent;
finalErrors.textContent = errorsDisplay.textContent;

// Guardar estadísticas
saveLessonStats();

// Mostrar modal
resultModal.classList.add('show');
    
    // No reiniciar las estadísticas aquí para que se mantengan visibles
}

function saveLessonStats() {
if (!currentUser || !currentLesson) return;

const stats = {
userId: currentUser.id,
lessonId: currentLesson.id,
lessonTitle: currentLesson.title,
date: new Date().toISOString(),
wpm: parseInt(wpmDisplay.textContent),
accuracy: parseInt(accuracyDisplay.textContent),
errors: parseInt(errorsDisplay.textContent),
time: timeDisplay.textContent
};

userStats.push(stats);
saveUserStats();
}

function loadStudentPanel() {
// Cargar lecciones en el select
lessonSelect.innerHTML = '';
lessons.forEach(lesson => {
const option = document.createElement('option');
option.value = lesson.id;
option.textContent = lesson.title;
lessonSelect.appendChild(option);
});

// Inicializar la primera lección
initLesson();

// Actualizar título y nivel de la lección actual
updateCurrentLessonInfo();
}

function updateCurrentLessonInfo() {
if (!currentLesson) return;

currentLessonTitle.textContent = currentLesson.title;
currentLessonStars.innerHTML = renderStars(currentLesson.level);
}

function loadStatsPanel() {
// Filtrar estadísticas del usuario actual
const userStatsData = userStats.filter(stat => stat.userId === currentUser.id);

// Actualizar resumen de estadísticas
totalLessons.textContent = userStatsData.length;

if (userStatsData.length > 0) {
const totalWpm = userStatsData.reduce((sum, stat) => sum + stat.wpm, 0);
const avgWpmValue = Math.round(totalWpm / userStatsData.length);
avgWpm.textContent = avgWpmValue;

const totalAccuracy = userStatsData.reduce((sum, stat) => sum + stat.accuracy, 0);
const avgAccuracyValue = Math.round(totalAccuracy / userStatsData.length);
avgAccuracy.textContent = `${avgAccuracyValue}%`;

const totalErrorsValue = userStatsData.reduce((sum, stat) => sum + stat.errors, 0);
totalErrorsStat.textContent = totalErrorsValue;
} else {
avgWpm.textContent = '0';
avgAccuracy.textContent = '0%';
totalErrorsStat.textContent = '0';
}

// Actualizar historial
historyTableBody.innerHTML = '';
userStatsData.forEach(stat => {
const row = document.createElement('tr');
row.innerHTML = `
<td>${stat.lessonTitle}</td>
<td>${new Date(stat.date).toLocaleDateString()}</td>
<td>${stat.wpm}</td>
<td>${stat.accuracy}%</td>
<td>${stat.errors}</td>
<td>${stat.time}</td>
`;
historyTableBody.appendChild(row);
});
}

// Event Listeners
studentBtn.addEventListener('click', () => {
studentBtn.classList.add('active');
adminBtn.classList.remove('active');
adminPasswordDiv.style.display = 'none';
studentLoginDiv.style.display = 'block';
studentCodeDiv.style.display = 'block';
loginSubtitle.textContent = 'Si eres alumno de Thames Centre, introduce tu nombre y código';
});

adminBtn.addEventListener('click', () => {
adminBtn.classList.add('active');
studentBtn.classList.remove('active');
adminPasswordDiv.style.display = 'block';
studentLoginDiv.style.display = 'none';
studentCodeDiv.style.display = 'none';
loginSubtitle.textContent = 'Introduce la contraseña de administrador';
});

accessBtn.addEventListener('click', () => {
if (studentBtn.classList.contains('active')) {
// Acceso como alumno
const name = studentNameInput.value.trim();
const code = studentCodeInput.value.trim();

if (!name || !code) {
showNotification('Por favor, introduce tu nombre y código', 'error');
return;
}

const user = users.find(u => u.username === name && u.code === code);
if (user) {
currentUser = { ...user, type: 'student' };
loginScreen.style.display = 'none';
studentPanel.style.display = 'block';
loadStudentPanel();
showNotification(`Bienvenido, ${name}`, 'success');
} else {
showNotification('Nombre o código incorrectos', 'error');
}
} else {
// Acceso como administrador
const password = passwordInput.value;
if (password === adminPassword) {
currentUser = { type: 'admin' };
loginScreen.style.display = 'none';
adminPanel.style.display = 'block';
loadAdminPanel();
showNotification('Bienvenido, administrador', 'success');
} else {
showNotification('Contraseña incorrecta', 'error');
}
}
});

exitBtn.addEventListener('click', () => {
if (confirm('¿Estás seguro de que quieres salir de la aplicación?')) {
window.close();
}
});

logoutAdminBtn.addEventListener('click', () => {
if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
currentUser = null;
adminPanel.style.display = 'none';
loginScreen.style.display = 'block';
passwordInput.value = '';
showNotification('Sesión cerrada', 'info');
}
});

logoutStudentBtn.addEventListener('click', () => {
if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
currentUser = null;
studentPanel.style.display = 'none';
loginScreen.style.display = 'block';
clearInterval(timerInterval);
showNotification('Sesión cerrada', 'info');
}
});

statsBtn.addEventListener('click', () => {
studentPanel.style.display = 'none';
statsPanel.style.display = 'block';
loadStatsPanel();
});

backToTyping.addEventListener('click', () => {
statsPanel.style.display = 'none';
studentPanel.style.display = 'block';
});

printStats.addEventListener('click', () => {
window.print();
});

// Panel de administración
function loadAdminPanel() {
renderLessons();
adminLessonBtnBottom.style.display = 'block';
}

newLessonBtn.addEventListener('click', () => {
editingLessonId = null;
formTitle.textContent = 'Nueva Lección';
lessonTitleInput.value = '';
lessonLevelInput.value = '1';
lessonContentInput.value = '';
lessonForm.classList.add('active');
});

adminLessonBtnBottom.addEventListener('click', () => {
editingLessonId = null;
formTitle.textContent = 'Nueva Lección';
lessonTitleInput.value = '';
lessonLevelInput.value = '1';
lessonContentInput.value = '';
lessonForm.classList.add('active');
});

saveLessonBtn.addEventListener('click', () => {
const title = lessonTitleInput.value.trim();
const level = parseInt(lessonLevelInput.value);
const content = lessonContentInput.value.trim();

if (!title || !content) {
showNotification('Por favor, completa todos los campos', 'error');
return;
}

if (editingLessonId) {
// Editar lección existente
const lessonIndex = lessons.findIndex(l => l.id === editingLessonId);
if (lessonIndex !== -1) {
lessons[lessonIndex] = {
...lessons[lessonIndex],
title,
level,
content
};
showNotification('Lección actualizada correctamente', 'success');
}
} else {
// Crear nueva lección
const newLesson = {
id: Date.now(),
title,
level,
content,
order: lessons.length + 1
};
lessons.push(newLesson);
showNotification('Lección creada correctamente', 'success');
}

saveLessons();
renderLessons();
lessonForm.classList.remove('active');
});

cancelLessonBtn.addEventListener('click', () => {
lessonForm.classList.remove('active');
});

// Gestión de alumnos
addStudentBtn.addEventListener('click', () => {
editingStudentId = null;
studentFormTitle.textContent = 'Añadir Alumno';
studentUsernameInput.value = '';
studentCodeInputAdmin.value = '';
studentForm.classList.add('active');
});

viewStudentsBtn.addEventListener('click', () => {
studentsManagement.style.display = 'block';
renderStudents();
});

saveStudentBtn.addEventListener('click', () => {
const username = studentUsernameInput.value.trim();
const code = studentCodeInputAdmin.value.trim();

if (!username || !code) {
showNotification('Por favor, completa todos los campos', 'error');
return;
}

if (editingStudentId) {
// Editar alumno existente
const studentIndex = users.findIndex(u => u.id === editingStudentId);
if (studentIndex !== -1) {
users[studentIndex] = {
...users[studentIndex],
username,
code
};
showNotification('Alumno actualizado correctamente', 'success');
}
} else {
// Crear nuevo alumno
// Verificar si el código ya existe
if (users.some(u => u.code === code)) {
showNotification('El código de acceso ya está en uso', 'error');
return;
}

const newStudent = {
id: Date.now(),
username,
code
};
users.push(newStudent);
showNotification('Alumno creado correctamente', 'success');
}

saveUsers();
renderStudents();
studentForm.classList.remove('active');
});

cancelStudentBtn.addEventListener('click', () => {
studentForm.classList.remove('active');
});

// Cambiar contraseña de administrador
document.getElementById('change-password-btn').addEventListener('click', () => {
const currentPassword = document.getElementById('current-password').value;
const newPassword = document.getElementById('new-password').value;
const confirmPassword = document.getElementById('confirm-password').value;

if (!currentPassword || !newPassword || !confirmPassword) {
showNotification('Por favor, completa todos los campos', 'error');
return;
}

if (currentPassword !== adminPassword) {
showNotification('La contraseña actual es incorrecta', 'error');
return;
}

if (newPassword !== confirmPassword) {
showNotification('Las nuevas contraseñas no coinciden', 'error');
return;
}

adminPassword = newPassword;
localStorage.setItem('adminPassword', adminPassword);
showNotification('Contraseña cambiada correctamente', 'success');

// Limpiar campos
document.getElementById('current-password').value = '';
document.getElementById('new-password').value = '';
document.getElementById('confirm-password').value = '';
});

// Eventos del panel de estudiante
lessonSelect.addEventListener('change', () => {
    const lessonId = parseInt(lessonSelect.value);
    currentLesson = lessons.find(lesson => lesson.id === lessonId);
    
    // Reiniciar completamente al cambiar de lección
    resetLessonCompletely();
    updateCurrentLessonInfo();
});

restartBtn.addEventListener('click', () => {
    resetLessonCompletely();
});

closeModalBtn.addEventListener('click', () => {
    resultModal.classList.remove('show');
    // No reiniciar la lección aquí para mantener las estadísticas visibles
});

// Event listener para el teclado
document.addEventListener('keydown', handleKeyDown);

// Inicializar la aplicación
initializeApp();
});
</script>
</body>
</html>